{% extends 'core/base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{{ job.title }} - {% trans "Jobsy" %}{% endblock %}

{% block extra_head %}
<style>
    /* Hide hero section only on job detail pages */
    .hero-section {
        display: none;
    }
    
    /* Add custom styling for job details page */
    .main-bg {
        background-color: var(--jobsy-light);
        padding-top: 20px;
    }
    
    .job-detail-header {
        background-color: var(--jobsy-blue);
        color: white;
        padding: 40px 0;
        margin-bottom: 30px;
    }
    
    .company-badge {
        width: 80px;
        height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: white;
        border-radius: 50%;
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        margin-bottom: 20px;
    }
</style>
{% endblock %}

{% block content %}
<div class="job-detail-header">
<div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 style="font-size:2.2rem; font-weight:700; margin-bottom:15px;">{{ job.title }}</h1>
                <div class="d-flex align-items-center mb-2">
                    <span style="font-size:1.2rem; font-weight:600; opacity:0.9;">{{ job.company }}</span>
                    <span class="mx-2 text-white">•</span>
                    <span style="opacity:0.9;">{{ job.location|default:_("თბილისი") }}</span>
                </div>
                <div class="d-flex gap-2 mb-1">
                    {% if job.premium_level == 'premium_plus' %}
                    <span class="badge rounded-pill" style="background-color:#a64dff; color:white; font-weight:500; padding:0.5em 1em;">
                        Premium+
                    </span>
                    {% elif job.premium_level == 'premium' %}
                    <span class="badge rounded-pill" style="background-color:#4d7bff; color:white; font-weight:500; padding:0.5em 1em;">
                        Premium
                    </span>
                    {% endif %}
                    <span class="badge rounded-pill" style="background-color:var(--jobsy-yellow); color:var(--jobsy-blue); font-weight:500; padding:0.5em 1em;">
                        {{ job.category|default:_("IT / კომპიუტერები") }}
                    </span>
                    <span class="badge rounded-pill" style="background-color:white; color:var(--jobsy-blue); font-weight:500; padding:0.5em 1em;">
                        {{ job.get_experience_display|default:_("სრული განაკვეთი") }}
                    </span>
                </div>
            </div>
            <div class="col-md-4 text-center text-md-end">
                {% if job.employer and job.employer.company_logo %}
                <div class="company-badge ms-auto me-0">
                    <img src="{{ job.employer.company_logo.url }}" alt="{{ job.company }}" style="width:60px; height:60px; object-fit:contain;">
                </div>
                {% else %}
                <div class="company-badge ms-auto me-0">
                    <span style="font-size:2rem; color:var(--jobsy-blue); font-weight:700;">{{ job.company|slice:":1" }}</span>
                        </div>
                        {% endif %}
                <div class="text-white">
                    <i class="far fa-clock me-1"></i>
                    {% trans "გამოქვეყნებულია" %} {{ job.posted_at|date:"d/m/Y" }}
                                </div>
                            </div>
                                </div>
                            </div>
                        </div>

<div class="container">
    <div class="row">
        <!-- Main content area -->
        <div class="col-lg-8 pe-lg-4">
            <!-- Job Content -->
            <div class="card mb-4 border-0 shadow-sm" style="border-radius:18px; background-color:#fff;">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center mb-4 pb-3 border-bottom">
                        <i class="fas fa-wallet me-2" style="color:var(--jobsy-blue);"></i>
                        <span style="font-weight:600; font-size:1.2rem;">
                            {% if job.salary_min and job.salary_max %}
                            {{ job.salary_min }} - {{ job.salary_max }} ₾ {{ job.salary_type }}
                            {% elif job.salary_min %}
                            {{ job.salary_min }} ₾ {{ job.salary_type }}
                            {% elif job.salary_max %}
                            {{ job.salary_max }} ₾ {{ job.salary_type }}
                            {% else %}
                            {% trans "ანაზღაურება შეთანხმებით" %}
                            {% endif %}
                        </span>
                    </div>

                    <div class="job-details">
                        <h3 style="font-size:1.4rem; font-weight:700; color:var(--jobsy-blue);">{% trans "აღწერა" %}</h3>
                    <div class="job-description mb-4">
                            {{ job.description|linebreaks }}
                        </div>
                    </div>

                    <div class="apply-section mt-4 pt-3 border-top">
                                <button class="btn btn-lg w-100" data-bs-toggle="modal" data-bs-target="#applyModal" style="background-color:var(--jobsy-blue); color:white; border-radius:12px; font-weight:600; padding:0.8rem;">
                                    <i class="fas fa-paper-plane me-2"></i> {% trans "განაცხადის გაგზავნა" %}
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Company Card -->
            <div class="card mb-4 border-0 shadow-sm" style="border-radius:18px; background-color:#fff;">
                <div class="card-body p-4">
                    <h3 style="font-size:1.4rem; font-weight:700; color:var(--jobsy-blue);">{% trans "კომპანიის შესახებ" %}</h3>
                    
                    <div class="d-flex align-items-center mb-3 mt-4">
                        {% if job.employer and job.employer.company_logo %}
                        <img src="{{ job.employer.company_logo.url }}" alt="{{ job.company }}" class="rounded-circle me-3" style="width:50px; height:50px; object-fit:cover;">
                        {% else %}
                        <div class="rounded-circle d-flex align-items-center justify-content-center me-3" style="width:50px; height:50px; background-color:var(--jobsy-light);">
                            <span style="font-size:1.4rem; color:var(--jobsy-blue); font-weight:700;">{{ job.company|slice:":1" }}</span>
                        </div>
                            {% endif %}
                        <div>
                            <h4 style="font-size:1.1rem; font-weight:600; margin-bottom:0;">{{ job.company }}</h4>
                            <p class="text-muted mb-0" style="font-size:0.9rem;">{{ job.employer.industry|default:_("IT სფერო") }}</p>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <p>{{ job.employer.company_description|default:_("კომპანიის აღწერა არ არის მითითებული.")|linebreaks }}</p>
                    </div>
                    
                    <div class="company-meta mb-4">
                        {% if job.employer %}
                        <div class="d-flex align-items-center mb-2">
                            <i class="fas fa-user-friends me-2 text-muted"></i>
                                <span>{{ job.employer.get_company_size_display }}</span>
                            </div>
                        <div class="d-flex align-items-center mb-2">
                                <i class="fas fa-map-marker-alt me-2 text-muted"></i>
                                <span>{{ job.employer.location }}</span>
                            </div>
                        {% if job.employer.company_website %}
                        <div class="d-flex align-items-center">
                            <i class="fas fa-globe me-2 text-muted"></i>
                            <a href="{{ job.employer.company_website }}" target="_blank" class="text-decoration-none">{{ job.employer.company_website }}</a>
                        </div>
                        {% endif %}
                        {% endif %}
                    </div>
                    
                    <a href="#" class="btn w-100" style="background-color:var(--jobsy-card); color:var(--jobsy-blue); border-radius:12px; font-weight:600; padding:0.8rem;">
                        <i class="fas fa-building me-2"></i> {% trans "კომპანიის პროფილი" %}
                    </a>
                </div>
            </div>

            <!-- Similar Jobs Card -->
            <div class="card border-0 shadow-sm" style="border-radius:18px; background-color:#fff;">
                <div class="card-body p-4">
                    <h3 style="font-size:1.4rem; font-weight:700; color:var(--jobsy-blue); margin-bottom:1.5rem;">{% trans "მსგავსი ვაკანსიები" %}</h3>
                    
                    {% for similar_job in similar_jobs|slice:":3" %}
                    <div class="similar-job-item mb-3 pb-3 {% if not forloop.last %}border-bottom{% endif %}">
                            <a href="{% url 'job_detail' similar_job.id %}" class="text-decoration-none">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h4 style="font-size:1.1rem; font-weight:600; color:#000; margin-bottom:5px;">{{ similar_job.title }}</h4>
                                    <p class="text-muted mb-1" style="font-size:0.95rem;">{{ similar_job.company }}</p>
                                    <div class="d-flex align-items-center" style="font-size:0.9rem;">
                                        <i class="fas fa-wallet me-1" style="color:#666;"></i>
                                        <span style="font-weight:500;">
                                            {% if similar_job.salary_min and similar_job.salary_max %}
                                            {{ similar_job.salary_min }} - {{ similar_job.salary_max }} ₾
                                            {% elif similar_job.salary_min %}
                                            {{ similar_job.salary_min }} ₾
                                            {% elif similar_job.salary_max %}
                                            {{ similar_job.salary_max }} ₾
                                            {% else %}
                                            {% trans "შეთანხმებით" %}
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                                <div class="d-flex flex-column align-items-end">
                                    {% if similar_job.premium_level == 'premium_plus' %}
                                    <span class="badge rounded-pill mb-2" style="background-color:#a64dff; color:white; padding:0.3em 0.6em; font-size:0.75rem;">
                                        Premium+
                                    </span>
                                    {% elif similar_job.premium_level == 'premium' %}
                                    <span class="badge rounded-pill mb-2" style="background-color:#4d7bff; color:white; padding:0.3em 0.6em; font-size:0.75rem;">
                                        Premium
                                    </span>
                                    {% endif %}
                                    <span class="badge rounded-pill" style="background-color:var(--jobsy-card); color:#333; padding:0.4em 0.8em; font-size:0.8rem;">
                                        {{ similar_job.job_preferences|default:_("სრული განაკვეთი")|truncatechars:12 }}
                                    </span>
                                </div>
                            </div>
                            </a>
                        </div>
                        {% empty %}
                    <div class="text-center text-muted py-4">
                        <i class="fas fa-briefcase fa-2x mb-3"></i>
                        <p>{% trans "მსგავსი ვაკანსიები არ მოიძებნა." %}</p>
                    </div>
                    {% endfor %}
                    
                    <a href="{% url 'job_list' %}" class="btn w-100 mt-3" style="background-color:var(--jobsy-light); color:#333; border-radius:12px; font-weight:600; padding:0.8rem;">
                        <i class="fas fa-search me-2"></i> {% trans "ყველა ვაკანსია" %}
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Apply Modal -->
<div class="modal fade" id="applyModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="border-radius:16px;">
            <div class="modal-header border-0 pb-0">
                <h5 class="modal-title" style="font-size:1.5rem; font-weight:700; color:var(--jobsy-blue);">{% trans "განაცხადი" %} - {{ job.title }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            {% if user.is_authenticated and user.userprofile.cv %}
                <form method="post" action="{% url 'apply_job' job.id %}">
                    {% csrf_token %}
                    <div class="modal-body p-4">
                        <div class="mb-4 text-center">
                            <i class="fas fa-file-alt fa-3x mb-3 text-success"></i>
                            <h5>{% trans "თქვენი პროფილის CV გამოყენებით მოხდება განაცხადის გაგზავნა." %}</h5>
                            <p class="text-muted">{% trans "თქვენი პროფილში ატვირთული CV ავტომატურად გადაეგზავნება დამსაქმებელს." %}</p>
                        </div>
                        <div class="mb-4">
                            <label for="id_cover_letter_profile_cv" class="form-label" style="font-weight:600;">{% trans "მოტივაციის წერილი" %}</label>
                            <textarea class="form-control" id="id_cover_letter_profile_cv" name="cover_letter" rows="5" style="border-radius:12px;"></textarea>
                            <div class="form-text text-muted">{% trans "Cover letter is optional." %}</div>
                        </div>
                    </div>
                    <div class="modal-footer border-0 pt-0 justify-content-center">
                        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal" style="border-radius:12px;">{% trans "გაუქმება" %}</button>
                        <button type="submit" class="btn btn-linkedin" style="border-radius:12px; font-weight:600;">{% trans "განაცხადის გაგზავნა" %}</button>
                    </div>
                </form>
            {% elif user.is_authenticated %}
            <form method="post" action="{% url 'apply_job' job.id %}" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="modal-body p-4">
                        <div class="mb-4">
                            <label for="id_applicant_name" class="form-label" style="font-weight:600;">{% trans "Name" %}</label>
                            <input type="text" class="form-control" id="id_applicant_name" name="applicant_name" style="border-radius:12px;" required>
                        </div>
                        <div class="mb-4">
                            <label for="id_applicant_email" class="form-label" style="font-weight:600;">{% trans "Email" %}</label>
                            <input type="email" class="form-control" id="id_applicant_email" name="applicant_email" style="border-radius:12px;" required>
                        </div>
                    <div class="mb-4">
                        <label for="id_cover_letter" class="form-label" style="font-weight:600;">{% trans "მოტივაციის წერილი" %}</label>
                        <textarea class="form-control" id="id_cover_letter" name="cover_letter" rows="5" style="border-radius:12px;"></textarea>
                            <div class="form-text text-muted">{% trans "Cover letter is optional." %}</div>
                    </div>
                    <div class="mb-4">
                        <label for="id_resume" class="form-label" style="font-weight:600;">{% trans "CV / რეზიუმე" %}</label>
                            <input type="file" class="form-control" id="id_resume" name="resume" accept=".pdf,.doc,.docx" style="border-radius:12px;" required>
                        <div class="form-text">{% trans "დასაშვები ფორმატი: PDF, DOC, DOCX" %}</div>
                    </div>
                </div>
                <div class="modal-footer border-0 pt-0">
                    <button type="button" class="btn" data-bs-dismiss="modal" style="border-radius:12px;">{% trans "გაუქმება" %}</button>
                    <button type="submit" class="btn" style="background-color:var(--jobsy-blue); color:white; border-radius:12px; font-weight:600;">{% trans "განაცხადის გაგზავნა" %}</button>
                </div>
            </form>
            {% else %}
                <form method="post" action="{% url 'apply_job' job.id %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    <div class="modal-body p-4">
                        <div class="mb-4">
                            <label for="id_applicant_name" class="form-label" style="font-weight:600;">{% trans "Name" %}</label>
                            <input type="text" class="form-control" id="id_applicant_name" name="applicant_name" style="border-radius:12px;" required>
                        </div>
                        <div class="mb-4">
                            <label for="id_applicant_email" class="form-label" style="font-weight:600;">{% trans "Email" %}</label>
                            <input type="email" class="form-control" id="id_applicant_email" name="applicant_email" style="border-radius:12px;" required>
                        </div>
                        <div class="mb-4">
                            <label for="id_cover_letter" class="form-label" style="font-weight:600;">{% trans "მოტივაციის წერილი" %}</label>
                            <textarea class="form-control" id="id_cover_letter" name="cover_letter" rows="5" style="border-radius:12px;"></textarea>
                            <div class="form-text text-muted">{% trans "Cover letter is optional." %}</div>
                        </div>
                        <div class="mb-4">
                            <label for="id_resume" class="form-label" style="font-weight:600;">{% trans "CV / რეზიუმე" %}</label>
                            <input type="file" class="form-control" id="id_resume" name="resume" accept=".pdf,.doc,.docx" style="border-radius:12px;" required>
                            <div class="form-text">{% trans "დასაშვები ფორმატი: PDF, DOC, DOCX" %}</div>
                        </div>
                    </div>
                    <div class="modal-footer border-0 pt-0">
                        <button type="button" class="btn" data-bs-dismiss="modal" style="border-radius:12px;">{% trans "გაუქმება" %}</button>
                        <button type="submit" class="btn" style="background-color:var(--jobsy-blue); color:white; border-radius:12px; font-weight:600;">{% trans "განაცხადის გაგზავნა" %}</button>
                    </div>
                </form>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Activate apply modal when apply button is clicked
    const applyBtn = document.querySelector('.apply-section button');
    if (applyBtn) {
        applyBtn.addEventListener('click', function() {
            const modal = new bootstrap.Modal(document.getElementById('applyModal'));
            modal.show();
        });
    }
});
</script>
{% endblock %} 