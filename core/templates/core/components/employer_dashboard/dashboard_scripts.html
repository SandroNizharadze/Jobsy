{% load i18n %}

<script>
function deleteJob(jobId) {
    if (confirm('Are you sure you want to delete this job listing?')) {
        fetch(`/employer/jobs/${jobId}/delete/`, {
            method: 'POST',
            headers: {
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value,
            },
        })
        .then(response => {
            if (response.ok) {
                window.location.reload();
            } else {
                throw new Error('Failed to delete job');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Failed to delete job. Please try again.');
        });
    }
}

// Job filtering functionality
document.addEventListener('DOMContentLoaded', function() {
    const filterLinks = document.querySelectorAll('.dropdown-menu .dropdown-item[data-filter]');
    const jobCards = document.querySelectorAll('.job-card');
    
    // Add click event listeners to all filter links
    filterLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Remove active class from all links and add to current
            filterLinks.forEach(item => item.classList.remove('active'));
            this.classList.add('active');
            
            const filterValue = this.getAttribute('data-filter');
            
            // Show all jobs if filter is 'all'
            if (filterValue === 'all') {
                jobCards.forEach(card => {
                    card.style.display = '';
                });
                return;
            }
            
            // Filter jobs based on selected filter
            jobCards.forEach(card => {
                const status = card.getAttribute('data-status');
                const isExpired = card.getAttribute('data-expired') === 'true';
                const expiresSoon = card.getAttribute('data-expires-soon') === 'true';
                
                let shouldShow = false;
                
                switch(filterValue) {
                    case 'active':
                        shouldShow = status === 'approved' && !isExpired;
                        break;
                    case 'in-review':
                        shouldShow = status === 'pending_review';
                        break;
                    case 'rejected':
                        shouldShow = status === 'rejected';
                        break;
                    case 'expired-soon':
                        shouldShow = isExpired || expiresSoon;
                        break;
                    default:
                        shouldShow = true;
                }
                
                card.style.display = shouldShow ? '' : 'none';
            });
        });
    });
});
</script> 